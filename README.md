# JSON Formatter

一个本地运行的 JSON 格式化小工具：支持多层嵌套 JSON 解码，树形视图展示，高亮、复制、历史记录与暗/亮主题切换。

所有解析逻辑均在浏览器本地完成，不上传任何数据。

![JSON Formatter Screenshot](./imgs/screenshot.png)

## 功能

- 自动格式化并高亮 JSON
- 自动尝试解码被多次 `JSON.stringify` / 转义的字符串
- 树形 JsonViewer：展开/折叠、显示元素/键数量、行级复制
- 支持在树视图中直接编辑值、重命名 key、增删节点（仅在 JSON 合法时启用）
- 顶部一键复制「美化 JSON」或「压缩 JSON」
- JSONPath 表格：多列查询、结果导出、单元格编辑并回写到 JSON
- 本地最多保留 100 条格式化记录，可快速回填
- 暗色 / 亮色主题，默认跟随系统，可手动切换

## 使用说明

### 1) 输入与格式化

1. 在左侧「输入 JSON」中粘贴/输入 JSON 文本。
2. 点击「格式化」会：
	 - 先解析根 JSON；
	 - 再递归尝试解码对象/数组中“看起来像 JSON 的字符串值”（多层嵌套场景）。
3. 当输入不合法时：右侧会显示错误提示，并进入“只读预览”（避免误编辑）。

左侧标题会展示当前输入的大小（KB）。

### 2) 树视图（Tree）

- 展开/折叠：右侧顶部「展开全部 / 折叠全部」。
- 复制：每一行的复制按钮会复制该节点的值（字符串复制时不带引号）。
- 编辑：双击某个原始值可编辑；对象 key 可重命名。
- 增删：在树节点上右键可新增属性/数组项或删除节点（仅在输入为合法 JSON 时可用）。

### 3) JSONPath 表格

右侧切换到「JSONPath」模式后：

- 列配置：点击表头可编辑“列名 / 表达式”，拖拽表头可调整列顺序。
- 自动补全：在表达式输入框中会显示候选（字段、数组索引等）。
	- 没有候选时按 Enter 会直接“完成”（关闭弹窗）。
	- 列名输入框按 Enter 也会直接“完成”。
- 导出：顶部「导出 JSON」会将表格结果复制到剪贴板。
- 重置：顶部「重置 JSONPath」会将表格恢复到初始状态（默认 1 列，表达式为 `$`），操作前会二次确认。
- 编辑并回写：对表格单元格使用“编辑”会把修改同步回右侧 JSON（基于 JSON Pointer 定位）。

### 4) 历史记录

- 每次解析成功会写入本地历史（最多 100 条，按输入内容去重）。
- 点击历史项可快速回填到输入框。

## 常见问题（FAQ）

### Q: 为什么我输入错误时右侧不能编辑？

为避免“输入文本与解析树”不一致，解析失败时会进入只读预览；修正左侧输入后会自动恢复编辑能力。

### Q: 什么是“多层嵌套 JSON 解码”？

一些接口会返回类似：

```json
{
	"data": "{\"items\":[1,2,3]}"
}
```

本工具会尝试把 `data` 这类字符串里的 JSON 再解析出来，便于直接查看和编辑。

## 开发

```bash
npm install
npm run dev
```

在浏览器中访问终端输出的本地地址（通常为 `http://localhost:5173/`）。

## 构建

```bash
npm run build
```

构建产物输出到 `dist` 目录，可用任意静态服务器托管。

## 技术栈

- React + TypeScript
- Vite
- 原生 CSS + CSS 变量（主题切换）
